# Akses Localhost dengan Python

Pada pertemuan sebelumnya telah depelajari pengenalan dasar bagaimana mengakses basis data dengan menggunakan Python ke MySQL dan PostgreSQL. Pada pertemuan kedua ini, akan fokus untuk berlatih untuk melakukan pemilihan data. Secara garis besar materi yang akan dibahas adalah; 

* Mengulang kembali bagaimana meng-akses basis data dengan Python ke MySQL dan PostgreSQL
* Membuat dan menghapus basis data
* Membuat database lengkap dengan melakukan import data dari Excel **(database rekayasa untuk pelatihan Data Analytics di JNE)**
* Operasi tabel pada database
* Menambahkan pengaturan batasan tabel 


## Koneksi MySQL dan Python

Untuk mengakses basis data yang ada pada MySQL dengan Python dapat menggunakan koding berikut di Jupiterlab anda. 

```{r include=FALSE}
library(reticulate)
library(Rcpp)
# conda_list()
use_condaenv("base", required = TRUE)
```

```{python, eval=F}
# import module 
import mysql.connector

# koneksi server
db1 = mysql.connector.connect(
  host='localhost',
  user='bakti',
  passwd='123'
)
```

Jika tidak muncul pesan error pada saat menjalankan koding diatas pada Chunck Jupiterlab anda. Artinya, koneksi Python ke MySQL sudah terhubung dengan baik. 

### Memeriksa Daftar Database

Setelah kita terhubung dengan local server menggunakan Python dan MySQL. Sekarang saatnya kita mulai untuk memerikas database apa saja yang ada didalamnya. 

```{python, eval=F}
# membuat objek 'cursor` sebagai kata kunci eksekusi SQL
cursor1 = db1.cursor()

# Perintah SQL
sql = 'SHOW DATABASES'

# Eksekusi perintah  SQL
cursor1.execute(sql)

# menampilkan daftar database
for x in cursor1:
  print(x) 
```

### Membuat Database

Berikut ini adalah koding yang dapat digunakan untuk membuat database baru dengan menggunakan koneksi `db.cursor()` yang ada pada objek `cursor`.

```{python, eval=F}
sql= 'CREATE DATABASE jne2'
cursor1.execute(sql)
```


### Menghapus Database 

Jika anda ingin menghapus database tertentu dari lokal server, maka dapat melakukannya dengan koding berikut:

```{python, eval=F}
sql= 'DROP DATABASE jne2'
cursor1.execute(sql)
```


### Memeriksa Daftar Tabel

Untuk memeriksa daftar tabel yang ada pada local server. Perhatikan Koding berikut:

```{python, eval=F}
# import module 
import mysql.connector

# koneksi salah satu database MySQl ke Python
db2 = mysql.connector.connect(
  host='localhost',
  user='bakti',
  passwd='123',
  database='jne2'
)

# membuat objek 'cursor` sebagai kata kunci eksekusi SQL
cursor2 = db2.cursor()

# Perintah SQL
sql = "SHOW TABLES"

# Eksekusi perintah  SQL
cursor2.execute(sql)

# menampilkan daftar tabel
for x in cursor2:
  print(x) 
```

## CRUD Lanjut 

Pada materi sebelumnya telah dipelajari bagaimana untuk melakukan `CRUDS` database. `CRUDS` merupakan singkatan dari **Create, Read, Update, Delete, dan Search**. Berikut ini akan diperlihatkan cara untuk menambahkan daftar database dari CSV. Langkah pertama, import data dari Excel menggukan Python.

```{python, eval=F}
import pandas as pd

link_data = 'https://raw.githubusercontent.com/dsciencelabs/JNE_Data_Analytics_PySQL/main/data/data_latihan/users.csv'

df1 = pd.read_csv(link_data, sep=';' )
df1.head(5)
```

### `Create` Tabel dari CSV 

Jika data tabel yang telah di import dari file CSV sudah ada dalam memori Jupeterlab **(Python)** anda, maka selanjutnya untuk menambahkan tabel tersebut ke database adalah sebagai berikut:

```{python, eval=F}
import pymysql
from sqlalchemy import create_engine

# membuat engine
engine = create_engine("mysql+pymysql://{user}:{pw}@localhost/{db}"
                       .format(user="bakti",
                               pw="123",
                               db="jne2"))

# df1.to_sql('users', engine, if_exists = 'append', index = True)
df1.to_sql('user', engine, if_exists='replace', index = False)
```

**Tugas Kelompok:**

Tambahkan tabel berikut ke database `jne2` dengan mengikuti materi yang sudah anda pelajari sebelumnya. 

* [https://raw.githubusercontent.com/dsciencelabs/JNE_Data_Analytics_PySQL/main/data/data_latihan/products.csv](https://raw.githubusercontent.com/dsciencelabs/JNE_Data_Analytics_PySQL/main/data/data_latihan/products.csv)
* [https://raw.githubusercontent.com/dsciencelabs/JNE_Data_Analytics_PySQL/main/data/data_latihan/orders.csv](https://raw.githubusercontent.com/dsciencelabs/JNE_Data_Analytics_PySQL/main/data/data_latihan/orders.csv)
* [https://raw.githubusercontent.com/dsciencelabs/JNE_Data_Analytics_PySQL/main/data/data_latihan/order_items.csv](https://raw.githubusercontent.com/dsciencelabs/JNE_Data_Analytics_PySQL/main/data/data_latihan/order_items.csv)
* [https://raw.githubusercontent.com/dsciencelabs/JNE_Data_Analytics_PySQL/main/data/data_latihan/inventory_items.csv](https://raw.githubusercontent.com/dsciencelabs/JNE_Data_Analytics_PySQL/main/data/data_latihan/inventory_items.csv)
* [https://raw.githubusercontent.com/dsciencelabs/JNE_Data_Analytics_PySQL/main/data/data_latihan/events.csv](https://raw.githubusercontent.com/dsciencelabs/JNE_Data_Analytics_PySQL/main/data/data_latihan/events.csv)
* [https://raw.githubusercontent.com/dsciencelabs/JNE_Data_Analytics_PySQL/main/data/data_latihan/distribution_centers.csv](https://raw.githubusercontent.com/dsciencelabs/JNE_Data_Analytics_PySQL/main/data/data_latihan/distribution_centers.csv)


### `Read` Dataframe

Berbeda dengan materi materi dasar yang kita pelajari sebelumnya, untuk membaca data tabel dari database dalam bentuk dataframe dapat dilakukan dengan cara berikut;

```{python, eval=F}
import pandas as pd

en_co = engine.connect()

df2 = pd.read_sql_table('distribution_centers', en_co)
df2
```

### `Update` Data  

Sama seperti yang telah dipelajari sebelumnya, melakukan update data pada tabel disini dapat dilakukan dengan cara berikut:

```{python, eval=F}
sql = 'UPDATE distribution_centers SET name=%s, latitude=%s, longitude=%s WHERE id=%s'
val = ("JNE Learning Center", 106.7977, -6.1774, 10)
cursor2.execute(sql, val)

db2.commit()

print("{} data diubah".format(cursor2.rowcount))
```

**Tugas Kelompok:**

* Tambahkan satu lokasi baru pada tabel `distribution_centers`
* Tambahkan tiga lokasi baru pada tabel `distribution_centers`


### `Delete` Data 

Pada bagian hapus data sama seperti update data. Kita harus menggunakan query DELETE untuk menghapus dan WHERE untuk menentukan data yang akan dihapus.

```{python, eval=F}
sql = "DELETE FROM distribution_centers WHERE id=%s"
val = (11, )
cursor2.execute(sql, val)

db2.commit()

print("{} data dihapus".format(cursor2.rowcount))
```

**Tugas Kelompok:**

* Hapuskan tiga lokasi baru sebelumnya, yang anda tambahkan pada tabel `distribution_centers` secara bersamaan.


## Mengubah Tabel 

Ada kalanya kita ingin menambah, memodifikasi, menghapus yang ada pada tabel. Pernyataan yang digunakan adalah `ALTER TABLE`, seperti diperlihatkan sebagai berikut:


### Menambah Kolom

Untuk menambahkan kolom dalam tabel, gunakan sintaks berikut:

```{python, eval=FALSE}
sql = "ALTER TABLE distribution_centers \
        ADD Email VARCHAR(100) \
        FIRST"
cursor2.execute(sql)

db2.commit()
```


### Drop Kolom

Untuk menghapus kolom dalam tabel, gunakan sintaks berikut (perhatikan bahwa beberapa sistem database tidak mengizinkan penghapusan kolom):

```{r eval=FALSE}
sql = "ALTER TABLE distribution_centers \
       DROP COLUMN Email\ "
cursor2.execute(sql)

db2.commit()
```


### Modifikasi Column

Untuk modifikasi nama kolom adalah sebagai berikut:

```{r eval=FALSE}
sql = "ALTER TABLE distribution_centers \
       MODIFY COLUMN Email Address\ "
cursor2.execute(sql)

db2.commit()
```


## Pengaturan Struktur Tabel

Pengaturan Struktur Tabel SQL digunakan untuk menentukan aturan struktur data dalam tabel. Batasan digunakan untuk membatasi jenis data yang dapat masuk ke dalam tabel, memastikan keakuratan dan keandalan data dalam tabel. Batasan dapat berupa tingkat kolom atau tingkat tabel. Batasan tingkat kolom berlaku untuk kolom, dan batasan tingkat tabel berlaku untuk keseluruhan tabel. Berikut Batasan yang biasanya digunakan dalam SQL:

* *NOT NULL:* Memastikan kolom tidak boleh memiliki nilai NULL
* *UNIQUE:* Memastikan bahwa semua nilai dalam kolom berbeda
* *PRIMARY KEY:* Kombinasi NOT NULL dan UNIQUE. Secara unik mengidentifikasi setiap baris dalam tabel
* *FOREIGN KEY:* Secara unik mengidentifikasi baris/record di tabel lain
* *CHECK:* Memastikan bahwa semua nilai dalam kolom memenuhi kondisi tertentu
* *DEFAULT:* Menetapkan nilai default untuk kolom saat tidak ada nilai yang ditentukan
* *INDEX:* Digunakan untuk membuat dan mengambil data dari database dengan sangat cepat
* *AUTO_INCREMENT:* memungkinkan inset data unik pada kolom tertentu yang dihasilkan secara otomatis saat data baru dimasukkan ke dalam tabel. Seringkali kolom ini adalah adalah juga *PRIMARY KEY* dan ingin dibuat secara otomatis setiap kali catatan baru dimasukkan.












